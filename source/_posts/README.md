---
title: Pywinauto使用——简单控制旺旺吧上网管理软件
data: 2017年6月24日下午12:29
tags:
- python
---

## Pywinauto使用——简单控制旺旺吧上网管理软件

#### 介绍

利用Python的库──pywinauto对Windows软件进行模拟人工的操作

#### 目标

对网吧内的相关人员进行快速下机处理

#### 说明

了解到用户的需求之后我想到了两种方式，一种是破解这个软件，直接控制，但这种不现实，本人技术能力有限。第二种是模拟人工的操作，脚本运行起来肯定比人快，所以我选择第二种方式解决这个问题。

首先进行调研，我首先想到的是自动化的工具，可是很多适合自动化的工具并没有用，很多适用于移动平台，比如Appium这种。

接着我尝试找一些模拟人工操作的软件，有Autoit，按键精灵等，但这些软件有一个问题，我还需要一个学习成本，还要去学对应的语言，这对我而言，太不爽了，我突然想到，Python的库这么多，会不会有Python对应的操作Windows软件的库呢，Google了一下，果然是有的，就是今天的主角──pywinauto

#### pywinauto的操作本质

pywinauto本质是对Windows句柄的操作需要先用spy++这种工具，利用`Finder Tool`查看当前窗口或控件的属性，根据Title、Class或者Handle进行识别的操作，得益于Python的便捷语法，写起来顺畅无比。

实际操作中，Handle的值每次打开都不一样，我又怕中文的支持不好，所以一般用Class定位操作窗口和控件，用Title识别程序。

#### 需求分析

用户的需求是「快速下机」，针对这个需求，我看了一下软件的操作步骤，得出以下操作步骤

1. 在快速通道的输入框中输入相关人员的身份证号末尾或者机器号，以便搜索出对应的机器
2. 敲回车键，搜索
3. 双击搜索出来的第一个机器，弹出下机提示框
4. 点击下机

整个流程就是这样，在写代码的过程中，对于pywinauto库的API大致浏览和查看，写到第三个步骤处卡住了，需要在搜索位置处双击，但是这个地方失败了，使用了相关的双击API传入坐标还是不行，这时我突然发现按下`Enter`键也可以，这样我就发送一个`Enter`键的指令就可以，接下来我也发现点击下机这个按钮也可以发送`Enter`

![](http://os19wcerd.bkt.clouddn.com/20170624115931_xJpukW_WX20170624-115403.jpeg)

![](http://os19wcerd.bkt.clouddn.com/20170624120000_i0ERI6_WX20170624-115534.jpeg)



#### 问题及处理：

遇到脏数据的处理：

这个问题是在实际运行中遇到的，比如我输入了一个身份证号，但是这个人已经下机走了，所以我根本搜索不到，也就不会弹出下机提示框，这个时候程序就一直在等待，大概有5~6秒，这对于实际使用是不可接受的，我查看API之后，有一个方法引起了我的注意`isVisible`，这应当是判断是否可见的方法，我用这个方法来判断这个弹出框是否可见，如果不可见就直接`pass`，进行下一步骤。

数据和代码分离：

为了防止使用的人操作代码，防止误操作，将数据存储在一个txt文件中，换行分隔，这里代码在读取数据的时候要注意去掉`\n`

脚本运行时相关程序必须前置：

目前还无法解决









